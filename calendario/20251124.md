---
exe-start: 37
exepro-start: 51
---

# Python: data manipulation

+ csv file access through csv library
+ pandas
    - information
    - filtering
    - reshaping

## Exercises in class

::: exefatti

Consider problem on translating from DNA to amino acid sequence: version with a csv file access

```python
import csv

DNAELEM = 'T'
RNAELEM = 'U'
CODON_SIZE = 3
END = "Stop"
ERROR = "Error"
SEP = ","

def loadcodontableshort(fname):
    codon_dic = {}
    try: 
        with open(fname, 'r', newline='') as infile:
            # creates a object, reader, able to read rows and extract its elements
            # based on the name of the column
            # avoids parsing and splitting 
            reader = csv.DictReader(infile)
            for row in reader:
                codon = row['Codon']
                one_letter = row['1Letter']
                codon_dic[codon] = one_letter
    except FileNotFoundError:
        print(f"File {fname} not accessible")
    return codon_dic

def codon2aa(seq, d):
    dim = len(seq)

    # create an empty result string
    aaseq = ""
    # for each codon (sequence of three elements)
        # find the corresponding encoding
        # append it to the result
    pos = 0
    last_pos = dim - CODON_SIZE
    while pos < last_pos:
        codon = seq[pos:pos+CODON_SIZE]
        try:
            aa = d[codon]
            aaseq += aa
            pos += CODON_SIZE
        except:
            print(f"codon {codon} not found")
            return aaseq + ERROR
    aaseq += END
    return aaseq

# MAIN FLOW
# ask the user the DNA string
dnaseq = input()
# load the file with the mapping
filename = input()
# convert into the RNA strand
rnaseq = dnaseq.replace(DNAELEM, RNAELEM)
d = loadcodontableshort(filename)
if d:
    aastring = codon2aa(rnaseq, d)
    print(aastring)
```

[file](../codice/90.dna2aa.filecsv.py)

:::

::: exefatti

**Diseases, symptoms and precautions**

[pd.disease.csv](../codice/files/pd.disease.csv)

| column      | description             |
|-------------|-------------------------|
| Disease     | The name of the disease |
| Description | The description         |

[pd.disease_precaution.csv](../codice/files/pd.disease_precaution.csv)

| column      | description             |
|-------------|-------------------------|
| Disease     | The name of the disease |
| Precaution_1| A precaution      |
| Precaution_2| A precaution      |
| Precaution_3| A precaution      |
| Precaution_4| A precaution      |

[pd.symptom.csv](../codice/files/pd.symptom.csv)

| column      | description             |
|-------------|-------------------------|
| Symptom     | The name of the symptom |
| Weight      | The severity level      |


Table reporting the treated patients who showed up with one or more symptoms and got diagnosed a disease.

[pd.disease_symptom.csv](../codice/files/pd.disease_symptom.csv)

| column      | description             |
|-------------|-------------------------|
| Disease     | The name of the diagnosed disease for the patient |
| Symptom_1   | A symptom declared by the patient      |
| Symptom_2   | A symptom declared by the patient      |
| ...   | A symptom declared by the patient      |
| Symptom_17   | A symptom declared by the patient      |



Loading data and exploring characteristics

**Q1**: Load data.

```Python
FNAME_D = "./sourcefile/files/pd.disease.csv"
FNAME_S = "./sourcefile/files/pd.symptom.csv"
FNAME_DP = "./sourcefile/files/pd.disease_precaution.csv"
FNAME_DS = "./sourcefile/files/pd.disease_symptom.csv"

dfd = pd.csv_read(FNAME_D)
dfs = pd.csv_read(FNAME_S)
dfdp = pd.csv_read(FNAME_DP)
dfds = pd.csv_read(FNAME_DS)
```


**Q2**: Gather information on the dataset.

```Python
df.info()

print(df.describe())
```

**Q3**: Identify severe symptoms, identified by a weight equal or higher than 5.

```Python
SEVERITY = 5

dfs_sev = dfs[dfs.Weight >= SEVERITY]
dfs_sev = dfs_sev.reset_index()
dfs_sev = dfs_sev.drop(columns=['index'])

# directly
dfs_sev = dfs[dfs.Weight >= SEVERITY]
dfs_sev = dfs_sev.reset_index(drop=True)
```

**Q4**: Create a tidy dataframe for the diseases and symptoms.

```Python
dfd_t = pd.melt(dfds,
                var_name='SymptomNum',
                value_name='Symptom',
                id_vars='Disease')
```

[file](../codice/90.diseases.py)

:::

## Proposed exercises

::: exepro

Write a program that accepts integer values from the user until 0 is introduced. The program saves values that are prime in file `primes.txt`. This is the solution of an AI tool to the problem. Would you accept it as is to make it your own in line with the guidelines learned during this class, or would you modify it? If you would modify, how?

```Python
def is_prime(n):
    if n < 2:
        return False
    for i in range(2, int(n**2**0.5) + 1):
        if n % i == 0:
            return False
    return True

primes = []

while True:
    try:
        num = int(input())
    except ValueError:
        print("Please enter a valid integer.")
        continue

    if num == 0:
        break

    if is_prime(num):
        primes.append(num)

# Save primes to file
with open("primes.txt", "w") as f:
    for p in primes:
        f.write(str(p) + "\n")

```

:::

Queries and data manipulation using the `diseases` data.

::: exepro


:::

::: exepro


:::